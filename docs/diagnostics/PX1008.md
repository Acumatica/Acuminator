# PX1008
This document describes the PX1008 diagnostic.

## Summary

| Code   | Short Description                                                                         | Type                           | Code Fix    | 
| ------ | ----------------------------------------------------------------------------------------- | ------------------------------ | ----------- | 
| PX1008 | The reference to the screen graph or an action adapter in the long operation and processing delegates cause synchronous execution of the delegate. | Error | Unavailable | 

## Diagnostic Description
`PXLongOperation` delegates should not contain references to the screen graph or an action adapter of the `PXAdapter` type because such references cause synchronous execution of the delegate.

The diagnostic uses data flow analysis that considers the passed data. This allows the diagnostic to check parameters passed to other graph and helper methods. 
For example, if a developer passes a screen graph or an action adapter as an argument to a method and, inside this method, invokes a long run operation that uses the passed arguments, this diagnostic captures such code. 
Corner cases not captured by the data flow analysis exist because live diagnostics has to limit resource usage and some things cannot be checked at compile time. But in our practice such cases are rarely encountered in the production code.    

To fix the issue, you rewrite the delegate so that it does not contain references to the screen graph or the action adapter.

The diagnostic also validates delegates passed to the `PXLongOperation.StartOperation()` method. This way you can find captured references to the graph instance and action adapters in the delegate closures.

## Example of Code that Results in the Warning

```C#
public class SomeGraph : PXGraph<SomeGraph>
{
    public PXFilteredProcessing<SomeDAC> Processing;
  
    public SomeGraph()
    {
        Processing.SetProcessDelegate(item => this.Process(item)); // The PX1008 error is displayed for this line.
    }
  
    private Process(SomeDAC item) { }
}
```

## Example of the Data Flow Analysis That Captures Helper Methods

Suppose that a helper class contains the following methods:
 - `CaptureInLongRun` which initiates a long run operation with a graph instance in the delegate
 - `CaptureInLongRunArray` which initiates a long run operation that captures the array of objects passed to it in the delegate
 
The diagnostic will show a warning as shown in the following code.

```C#
public IEnumerable someAction(PXAdapter adapter)
{
	var helper = new NonGraph();
	helper.CaptureInLongRun(this);                      // The PX1008 error is displayed for this line.
	helper.CaptureInLongRunArray(new[] { adapter });    // The PX1008 error is displayed for this line.

	return adapter.Get();
}
```