# PX1008
This document describes the PX1008 diagnostic.

## Summary

| Code   | Short Description                                                                         | Type                           | Code Fix    | 
| ------ | ----------------------------------------------------------------------------------------- | ------------------------------ | ----------- | 
| PX1008 | The reference to the screen graph or an action adapter in the long operation and processing delegates cause synchronous execution of the delegate. | Error | Unavailable | 

## Diagnostic Description
`PXLongOperation` delegates should not contain references to `@this` graph or an action adapter of the `PXAdapter` type because such references cause synchronous execution of the delegate.

The diagnostic uses data flow analysis that considers the passed data. This allows the diagnostic to check parameters passed to other graph and helper methods. For example, if a developer passes a screen graph or an action adapter as an argument to a method and, inside this method, invokes a long run operation that uses the passed arguments, this diagnostic captures such code.

To fix the issue, you rewrite the delegate so that it does not contain references to `@this` graph or the action adapter.

The diagnostic also validates delegates passed to the `PXLongOperation.StartOperation()` method. This way you can find captured references to the graph instance and action adapters in the delegate closures.

## Example of Code that Results in the Warning

```C#
public class SomeGraph : PXGraph<SomeGraph>
{
    public PXFilteredProcessing<SomeDAC> Processing;
  
    public SomeGraph()
    {
        Processing.SetProcessDelegate(item => this.Process(item)); // The PX1008 warning is displayed for this line.
    }
  
    private Process(SomeDAC item) { }
}
```

## Example of the Data Flow Analysis That Captures Helper Methods

Suppose that a helper class contains the following methods:
 - `RunLongRunWithoutCapture` which initiates a mass processing operation without a graph or an action adapter in the delegate
 - `SetProcessingWithGraphCapture` which initiates a mass processing operation with a graph instance in the delegate
 - `SetProcessingWithAdapterCapture` which initiates a mass processing operation with an action adapter in the delegate
 
The diagnostic will show a warning as shown in the following code.

```C#
public IEnumerable someAction(PXAdapter adapter)
{
	var helper = new NonGraph();
	helper.RunLongRunWithoutCapture(_processing);                    // No diagnostic warning
	helper.SetProcessingWithGraphCapture(_processing, this);         // Show diagnostic warning
	helper.SetProcessingWithAdapterCapture(_processing, adapter);    // Show diagnostic warning

	return adapter.Get();
}
```