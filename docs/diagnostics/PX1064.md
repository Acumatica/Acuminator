# PX1064
This document describes the PX1064 diagnostic.

## Summary

| Code   | Short Description                                                                         | Type                           | Code Fix    | 
| ------ | ----------------------------------------------------------------------------------------- | ------------------------------ | ----------- | 
| PX1064 | The declaration of the exception class introduces new serializable fields but does not declare an override for the `GetObjectData` method. This will cause an incorrect deserialization of the exception data and will lead to runtime errors in Acumatica ERP. | Error | Available | 

## Diagnostic Description

Every class that that is derived from the System.Exception class (including PXException-derived classes) that declares new serializable data always provide an override for the `GetObjectData` method.

By serializable data, the diagnostic understands any new data declared in the exception class that will be serialized by .Net serializers and Acumatica reflection based serializer which are the following:
 - New fields if they are not marked with `System.NonSerializedAttribute` attribute:
 - New auto generated properties if they are not marked with `System.NonSerializedAttribute` attribute:
For example, the following types of members are not considered serializable:
 - Static fields and constants
 - Static properties
 - Calculated properties
 - Properties with explicit backing field
 - Fields and properties marked as non serializable

The code fix generates the missing GetObjectData method override that contains the following statements:
 1. A call to the `GetObjectData` static method of the `PX.Common.ReflectionSerializer` class
 2. A call to the base `GetObjectData` method:
    ```C#
    csharp base.GetObjectData(info, context);
    ```
> **_Note:_** In older versions of Acumatica ERP, there is no `PX.Common.ReflectionSerializer` class because it was added as a refactoring later. The `PX.Common.PXReflectionSerializer` class will be used instead, the names of the methods are the same.


## Example of Incorrect Code

```C#
public sealed class PXNewSerializableAutoPropertiesException : PXBaseRedirectException
{
	/// <summary>
	/// Identificator of the document that should be signed
	/// </summary>
	public Guid FileId { get; private set; }
	/// <summary>
	/// View name from which sign action is called
	/// </summary>
	public string ViewName { get; private set; }

	public PXNewSerializableAutoPropertiesException(string viewName, Guid fileId) : base(fileId.ToString())
	{
		ViewName = viewName;
		FileId = fileId;
	}

	private PXNewSerializableAutoPropertiesException(System.Runtime.Serialization.SerializationInfo info, System.Runtime.Serialization.StreamingContext context) : base(info, context)
	{
		FileId = (Guid)info.GetValue(nameof(FileId), typeof(Guid));
		ViewName = info.GetString(nameof(ViewName));
	}

	private bool Foo() => true;
}
```

## Example of the Code Fix

```C#
public sealed class PXNewSerializableAutoPropertiesException : PXBaseRedirectException
{
    /// <summary>
    /// Identificator of the document that should be signed
    /// </summary>
    public Guid FileId { get; private set; }
    /// <summary>
    /// View name from which sign action is called
    /// </summary>
    public string ViewName { get; private set; }

    public PXNewSerializableAutoPropertiesException(string viewName, Guid fileId) : base(fileId.ToString())
    {
        ViewName = viewName;
        FileId = fileId;
    }

    private PXNewSerializableAutoPropertiesException(System.Runtime.Serialization.SerializationInfo info, System.Runtime.Serialization.StreamingContext context) : base(info, context)
    {
        FileId = (Guid)info.GetValue(nameof(FileId), typeof(Guid));
        ViewName = info.GetString(nameof(ViewName));
    }

    public override void GetObjectData(SerializationInfo info, StreamingContext context)
    {
        ReflectionSerializer.GetObjectData(this, info);
        base.GetObjectData(info, context);
    }

    private bool Foo() => true;
}
```